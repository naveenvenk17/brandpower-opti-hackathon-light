{% extends "base.html" %}

{% block title %}Portfolio Optimization - BrandCompass.ai{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="hero-title text-center mb-4">Portfolio Optimization</h1>

    <section id="optimizationSection" class="mb-5">
        <h2 class="section-header">Optimize Marketing Spend</h2>
        <div class="card">
            <div class="card-body">
                <div class="form-group">
                    <label for="totalBudget">Total Budget</label>
                    <input type="number" id="totalBudget" class="form-control" placeholder="Enter total budget">
                </div>
                <button class="btn btn-primary btn-large btn-block" onclick="runOptimization()">Run Optimization</button>
                <div id="optimizationResults" class="mt-4"></div>
            </div>
        </div>
    </section>
</div>

<script>
function runOptimization() {
    const totalBudget = document.getElementById('totalBudget').value;
    if (!totalBudget) {
        alert('Please enter a total budget.');
        return;
    }

    const resultsContainer = document.getElementById('optimizationResults');
    resultsContainer.innerHTML = '<div class="spinner"></div><p class="text-center">Running optimization...</p>';

    fetch('http://127.0.0.1:8010/api/v1/optimize/allocation', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ total_budget: parseFloat(totalBudget) })
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            resultsContainer.innerHTML = `<div class="alert alert-danger"><strong>Error:</strong> ${data.error}</div>`;
            return;
        }

        let resultsHTML = '<h3>Optimization Results</h3>';
        resultsHTML += `<p><strong>Expected Lift:</strong> ${data.expected_lift.toFixed(4)}</p>`;
        resultsHTML += `<p><strong>ROI:</strong> ${data.roi.toFixed(4)}</p>`;
        resultsHTML += '<h4>Optimal Allocation:</h4>';
        resultsHTML += '<ul class="list-group">';
        for (const channel in data.optimal_allocation) {
            resultsHTML += `<li class="list-group-item d-flex justify-content-between align-items-center">${channel}<span class="badge badge-primary badge-pill">$${data.optimal_allocation[channel].toLocaleString()}</span></li>`;
        }
        resultsHTML += '</ul>';
        resultsContainer.innerHTML = resultsHTML;
    })
    .catch(error => {
        resultsContainer.innerHTML = `<div class="alert alert-danger"><strong>Error:</strong> ${error.message}</div>`;
    });
}
</script>
{% endblock %}
